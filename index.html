<!DOCTYPE html>
<html lang="vi" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xử Lý Văn Bản</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        html { -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Inter', sans-serif; overscroll-behavior-y: none; }
        textarea::-webkit-scrollbar { width: 8px; }
        textarea::-webkit-scrollbar-track { background: #f1f5f9; border-radius: 10px; }
        textarea::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 10px; }
        textarea::-webkit-scrollbar-thumb:hover { background: #64748b; }
        .textarea-container { display: flex; flex-direction: column; min-height: 0; }
        .textarea-container textarea { flex-grow: 1; min-height: 200px; }
        /* Animation cho icon xử lý */
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .animate-spin-slow { animation: spin 2s linear infinite; }
    </style>
</head>
<body class="h-full flex flex-col bg-slate-100 text-slate-800">
    <header class="bg-white/80 backdrop-blur-sm border-b border-slate-200 p-4 shadow-sm">
        <h1 class="text-xl font-bold text-center text-slate-900">Xử Lý Văn Bản</h1>
    </header>

    <main class="flex-grow p-2 sm:p-4 overflow-y-auto">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 h-full">
            
            <!-- Vùng nhập liệu -->
            <div class="textarea-container bg-white rounded-xl shadow-sm border border-slate-200">
                <label for="inputText" class="block text-base font-semibold p-3 border-b border-slate-200">Văn bản gốc</label>
                <textarea id="inputText" class="w-full p-3 bg-transparent rounded-b-xl focus:outline-none resize-none" placeholder="Dán văn bản của bạn vào đây..."></textarea>
            </div>

            <!-- Vùng kết quả -->
            <div class="textarea-container bg-white rounded-xl shadow-sm border border-slate-200">
                <label for="outputText" class="block text-base font-semibold p-3 border-b border-slate-200">Kết quả</label>
                <textarea id="outputText" readonly class="w-full p-3 bg-slate-50 rounded-b-xl focus:outline-none resize-none"></textarea>
            </div>

        </div>
    </main>

    <!-- Thanh menu điều khiển -->
    <footer class="flex-shrink-0 bg-white/80 backdrop-blur-sm border-t border-slate-200 shadow-t-lg p-3">
        <div class="max-w-4xl mx-auto flex items-center justify-center gap-3">
            <button id="processButton" class="bg-indigo-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-indigo-700 active:scale-95 transition-all duration-150 shadow-md flex items-center justify-center gap-3 w-full sm:w-auto">
                <svg id="processIcon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2L14.5 8.5L21 10L14.5 11.5L12 18L9.5 11.5L3 10L9.5 8.5L12 2Z"/><path d="M4 2L5 4"/><path d="M19 13L20 15"/><path d="M2 17L3 15"/><path d="M12 22L11 20"/></svg>
                <svg id="loadingIcon" class="hidden animate-spin-slow" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg>
                <span id="buttonText">Xử lý</span>
            </button>
            <button id="copyButton" title="Sao chép" class="bg-green-600 text-white font-bold p-3 rounded-lg hover:bg-green-700 active:scale-95 transition-all duration-150 shadow-sm">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
            </button>
            <button id="clearAllButton" title="Xóa hết" class="bg-red-600 text-white font-bold p-3 rounded-lg hover:bg-red-700 active:scale-95 transition-all duration-150 shadow-sm">
                 <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
            </button>
        </div>
    </footer>

    <!-- Thông báo nhanh (Toast) -->
    <div id="toast" class="fixed bottom-24 right-5 bg-slate-900 text-white py-2 px-5 rounded-lg shadow-xl opacity-0 translate-y-3 transition-all duration-300 pointer-events-none">
        Đã sao chép!
    </div>

    <script>
        // DOM Elements
        const inputText = document.getElementById('inputText');
        const outputText = document.getElementById('outputText');
        const processButton = document.getElementById('processButton');
        const copyButton = document.getElementById('copyButton');
        const clearAllButton = document.getElementById('clearAllButton');
        const toast = document.getElementById('toast');
        const processIcon = document.getElementById('processIcon');
        const loadingIcon = document.getElementById('loadingIcon');
        const buttonText = document.getElementById('buttonText');

        // --- Core Gemini Processing Function ---
        async function processWithGemini() {
            const originalText = inputText.value.trim();
            if (!originalText) {
                outputText.value = "Vui lòng nhập văn bản để xử lý.";
                return;
            }

            // Set loading state
            setLoading(true);
            outputText.value = "Gemini đang xử lý, vui lòng chờ...";

            // The API endpoint is now our own backend server
            const apiUrl = '/api/process-text';

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ originalText: originalText })
                });

                const result = await response.json();

                if (!response.ok) {
                    throw new Error(result.error || `Lỗi từ server: ${response.statusText}`);
                }
                
                if (result.formattedText) {
                    outputText.value = result.formattedText;
                } else {
                    throw new Error("Không nhận được kết quả hợp lệ từ server.");
                }

            } catch (error) {
                console.error("Lỗi khi gọi API:", error);
                outputText.value = `Đã xảy ra lỗi: ${error.message}. Vui lòng kiểm tra lại.`;
            } finally {
                // End loading state
                setLoading(false);
            }
        }

        // --- UI Helper Functions ---

        function setLoading(isLoading) {
            if (isLoading) {
                processButton.disabled = true;
                processIcon.classList.add('hidden');
                loadingIcon.classList.remove('hidden');
                buttonText.textContent = 'Đang xử lý...';
            } else {
                processButton.disabled = false;
                processIcon.classList.remove('hidden');
                loadingIcon.classList.add('hidden');
                buttonText.textContent = 'Xử lý';
            }
        }
        
        function copyToClipboard() {
            if (outputText.value) {
                 if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(outputText.value).then(showToast).catch(copyFallback);
                } else {
                    copyFallback();
                }
            }
        }

        function copyFallback() {
            const tempTextArea = document.createElement('textarea');
            tempTextArea.value = outputText.value;
            tempTextArea.style.position = 'fixed';
            tempTextArea.style.left = '-9999px';
            document.body.appendChild(tempTextArea);
            tempTextArea.select();
            try {
                document.execCommand('copy');
                showToast();
            } catch (err) {
                console.error('Lỗi sao chép (fallback): ', err);
            }
            document.body.removeChild(tempTextArea);
        }

        function showToast() {
            toast.classList.remove('opacity-0', 'translate-y-3');
            toast.classList.add('opacity-100', 'translate-y-0');
            setTimeout(() => {
                toast.classList.remove('opacity-100', 'translate-y-0');
                toast.classList.add('opacity-0', 'translate-y-3');
            }, 2000);
        }

        function clearAll() {
            inputText.value = '';
            outputText.value = '';
        }

        // --- Event Listeners ---
        processButton.addEventListener('click', processWithGemini);
        copyButton.addEventListener('click', copyToClipboard);
        clearAllButton.addEventListener('click', clearAll);

    </script>
</body>
</html>

